{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/digvi/Desktop/React Projects/itchy-feet/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"C:/Users/digvi/Desktop/React Projects/itchy-feet/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _defineProperty from\"C:/Users/digvi/Desktop/React Projects/itchy-feet/frontend/node_modules/@babel/runtime/helpers/esm/defineProperty.js\";import _objectSpread from\"C:/Users/digvi/Desktop/React Projects/itchy-feet/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"C:/Users/digvi/Desktop/React Projects/itchy-feet/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useContext}from'react';import\"./booking.css\";import{Form,FormGroup,ListGroup,ListGroupItem,Button}from\"reactstrap\";import{AuthContext}from'../../context/AuthContext';import{loadStripe}from\"@stripe/stripe-js\";import{BASE_URL}from\"../../utils/config\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Booking=function Booking(_ref){var tour=_ref.tour,avgRating=_ref.avgRating;var price=tour.price,reviews=tour.reviews,title=tour.title,photo=tour.photo;var _useContext=useContext(AuthContext),user=_useContext.user;var _useState=useState({userId:user&&user._id,userEmail:user&&user.email,tourName:title,fullName:'',phone:'',guestSize:1,bookAt:'',photo:photo}),_useState2=_slicedToArray(_useState,2),booking=_useState2[0],setBooking=_useState2[1];var stripePromise=loadStripe(\"pk_test_51Mv1TuSB5S2Tmnfl10IzoeX7b5zvsASXXfHq9plE1PjSoXm8dkXGtViIsylIi3Xn6K1CQRqvRlw3U2GUVUTlItD8001OQWL4cr\");var handleChange=function handleChange(e){setBooking(function(prev){return _objectSpread(_objectSpread({},prev),{},_defineProperty({},e.target.id,e.target.value));});};var serviceFee=799;var totalAmount=Number(price)*Number(booking.guestSize)+Number(serviceFee);// send booking data to server\nvar handleClick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(e){var stripe,res,result;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:e.preventDefault();_context.prev=1;if(!(!user||user===undefined||user===null)){_context.next=4;break;}return _context.abrupt(\"return\",alert(\"Please sign in\"));case 4:_context.next=6;return stripePromise;case 6:stripe=_context.sent;_context.next=9;return fetch(\"\".concat(BASE_URL,\"/booking\"),{method:'POST',headers:{'content-type':'application/json'},credentials:'include',body:JSON.stringify(_objectSpread(_objectSpread({},booking),{},{totalAmount:totalAmount}))});case 9:res=_context.sent;_context.next=12;return res.json();case 12:result=_context.sent;if(res.ok){_context.next=15;break;}return _context.abrupt(\"return\",alert(result.message));case 15:_context.next=17;return stripe.redirectToCheckout({sessionId:result.session.id});case 17:_context.next=22;break;case 19:_context.prev=19;_context.t0=_context[\"catch\"](1);alert(_context.t0.message);case 22:case\"end\":return _context.stop();}},_callee,null,[[1,19]]);}));return function handleClick(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"booking\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"booking__top d-flex align-items-center justify-content-between\",children:[/*#__PURE__*/_jsxs(\"h3\",{children:[\"\\u20B9\",price,\" \",/*#__PURE__*/_jsx(\"span\",{children:\"/per person\"})]}),/*#__PURE__*/_jsxs(\"span\",{className:\"tour__rating d-flex align-items-center\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"ri-star-s-fill\"}),avgRating===0?null:avgRating,\" (\",reviews===null||reviews===void 0?void 0:reviews.length,\")\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"booking__form\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Information\"}),/*#__PURE__*/_jsxs(Form,{className:\"booking__info-form\",onSubmit:handleClick,children:[/*#__PURE__*/_jsx(FormGroup,{children:/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Full Name\",id:\"fullName\",required:true,onChange:handleChange})}),/*#__PURE__*/_jsx(FormGroup,{children:/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Phone\",id:\"phone\",required:true,onChange:handleChange})}),/*#__PURE__*/_jsxs(FormGroup,{className:\"d-flex align-items-center gap-3\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"date\",placeholder:\"\",id:\"bookAt\",required:true,onChange:handleChange}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",placeholder:\"Guest\",id:\"guestSize\",min:\"1\",required:true,onChange:handleChange})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"booking__bottom\",children:[/*#__PURE__*/_jsxs(ListGroup,{children:[/*#__PURE__*/_jsxs(ListGroupItem,{className:\"border-0 px-0\",children:[/*#__PURE__*/_jsxs(\"h5\",{className:\"d-flex align-items-center gap-1\",children:[\"\\u20B9\",price,\" \",/*#__PURE__*/_jsx(\"i\",{className:\"ri-close-line\"}),\" 1 person \"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",price]})]}),/*#__PURE__*/_jsxs(ListGroupItem,{className:\"border-0 px-0\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Service charge\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",serviceFee]})]}),/*#__PURE__*/_jsxs(ListGroupItem,{className:\"border-0 px-0 total\",children:[/*#__PURE__*/_jsx(\"h5\",{children:\"Total\"}),/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u20B9\",totalAmount]})]})]}),/*#__PURE__*/_jsx(Button,{className:\"btn primary__btn w-100 mt-4\",onClick:handleClick,children:\"Book Now\"})]})]});};export default Booking;","map":{"version":3,"names":["React","useState","useContext","Form","FormGroup","ListGroup","ListGroupItem","Button","AuthContext","loadStripe","BASE_URL","jsx","_jsx","jsxs","_jsxs","Booking","_ref","tour","avgRating","price","reviews","title","photo","_useContext","user","_useState","userId","_id","userEmail","email","tourName","fullName","phone","guestSize","bookAt","_useState2","_slicedToArray","booking","setBooking","stripePromise","handleChange","e","prev","_objectSpread","_defineProperty","target","id","value","serviceFee","totalAmount","Number","handleClick","_ref2","_asyncToGenerator","_regeneratorRuntime","mark","_callee","stripe","res","result","wrap","_callee$","_context","next","preventDefault","undefined","abrupt","alert","sent","fetch","concat","method","headers","credentials","body","JSON","stringify","json","ok","message","redirectToCheckout","sessionId","session","t0","stop","_x","apply","arguments","className","children","length","onSubmit","type","placeholder","required","onChange","min","onClick"],"sources":["C:/Users/digvi/Desktop/React Projects/itchy-feet/frontend/src/components/Booking/Booking.jsx"],"sourcesContent":["import React, {useState, useContext} from 'react';\nimport \"./booking.css\";\nimport {Form, FormGroup, ListGroup, ListGroupItem, Button} from \"reactstrap\";\nimport { AuthContext } from '../../context/AuthContext';\nimport {loadStripe} from \"@stripe/stripe-js\";\n\nimport {BASE_URL} from \"../../utils/config\";\n\nconst Booking = ({tour, avgRating}) => {\n    const {price, reviews, title, photo} = tour;\n\n    const {user} = useContext(AuthContext);\n\n    const [booking, setBooking] = useState({\n        userId: user && user._id,\n        userEmail: user && user.email,\n        tourName:title,\n        fullName:'',\n        phone: '',\n        guestSize:1,\n        bookAt: '',\n        photo: photo\n    });\n    const stripePromise = loadStripe(\"pk_test_51Mv1TuSB5S2Tmnfl10IzoeX7b5zvsASXXfHq9plE1PjSoXm8dkXGtViIsylIi3Xn6K1CQRqvRlw3U2GUVUTlItD8001OQWL4cr\")\n\n    const handleChange = e => {\n        setBooking(prev => ({...prev, [e.target.id]: e.target.value}))\n    }\n\n    const serviceFee = 799;\n    const totalAmount = Number(price) * Number(booking.guestSize) + Number(serviceFee);\n\n    // send booking data to server\n    const handleClick = async (e) => {\n        e.preventDefault();\n        try{\n           if(!user || user===undefined||user===null){\n            return alert(\"Please sign in\")\n           }\n        //    create checkout session\n        const stripe = await stripePromise;\n        const res = await fetch(`${BASE_URL}/booking`, {\n            method: 'POST',\n            headers: {\n                'content-type': 'application/json'\n            },\n            credentials:'include',\n            body: JSON.stringify({...booking, totalAmount}),\n        });\n        //    const res = await fetch(`${BASE_URL}/booking`,{\n        //     method: 'POST',\n        //     headers: {\n        //         'content-type': 'application/json'\n        //     },\n        //     credentials:'include',\n        //     body: JSON.stringify(booking)\n        //    })\n           const result = await res.json()\n\n           if(!res.ok){\n            return alert(result.message)\n           }\n        //    navigate(\"/thank-you\");\n        // Redirect to Stripe Checkout Page\n        await stripe.redirectToCheckout({sessionId: result.session.id});\n    }catch(err){\n        alert(err.message);\n\n    }     \n    }\n\n  return (\n    <div className='booking'>\n        <div className=\"booking__top d-flex align-items-center justify-content-between\">\n            <h3>â‚¹{price} <span>/per person</span></h3>\n            <span className=\"tour__rating d-flex align-items-center\">\n                <i className=\"ri-star-s-fill\" ></i>\n                {avgRating === 0 ? null : avgRating} ({reviews ?.length}) \n            </span>\n        </div>\n\n        {/* booking form start */}\n        <div className='booking__form'>\n            <h5>Information</h5>\n            <Form className='booking__info-form' onSubmit={handleClick}>\n                <FormGroup>\n                    <input type=\"text\" placeholder='Full Name' id='fullName' required onChange={handleChange} />\n                </FormGroup>\n                <FormGroup>\n                    <input type=\"number\" placeholder='Phone' id='phone' required onChange={handleChange} />\n                </FormGroup>\n                <FormGroup className='d-flex align-items-center gap-3'>\n                    <input type=\"date\" placeholder='' id='bookAt' required onChange={handleChange} />\n                    <input type=\"number\" placeholder='Guest' id='guestSize' min='1' required onChange={handleChange} />\n                </FormGroup>\n            </Form>\n        </div>\n        {/* booking form end */}\n\n        {/* booking bottom */}\n        <div className='booking__bottom'>\n            <ListGroup>\n                <ListGroupItem className='border-0 px-0'>\n                    <h5 className='d-flex align-items-center gap-1'>â‚¹{price} <i className='ri-close-line'></i> 1 person </h5>\n                    <span>â‚¹{price}</span>\n                </ListGroupItem>\n                <ListGroupItem className='border-0 px-0'>\n                    <h5>Service charge</h5>\n                    <span>â‚¹{serviceFee}</span>\n                </ListGroupItem>\n                <ListGroupItem className='border-0 px-0 total'>\n                    <h5>Total</h5>\n                    <span>â‚¹{totalAmount}</span>\n                </ListGroupItem>\n            </ListGroup>\n\n            <Button className='btn primary__btn w-100 mt-4' onClick={handleClick}>Book Now</Button>\n        </div>\n    </div>\n  )\n}\n\nexport default Booking"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}